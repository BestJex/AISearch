<!DOCTYPE html>
<html>
<head>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="/css/element-ui.min.css">
    <link rel="stylesheet" href="/css/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/my-select.css">
    <style>
        .search {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

    </style>
</head>
<body>
<div id="app" class="search" style="display: none">
    <div @click="toggle" @keyup.enter="toDetails(store.keyword)">
        <el-input id="el-input" style="width: 500px;" @input="searchItem(store.keyword)" placeholder="搜你想要"
                  v-model="store.keyword">
        </el-input>

        <ul style="position: absolute;" v-show="isShow">
            <li @click="upScreen(item.title)" v-for="item in store.article" :value="item.id"
                :style="{width : width +'px'}">
                {{item.title}}
            </li>
        </ul>
    </div>

    <el-button @click="toDetail(store.keyword)">{{message}}</el-button>

</div>
</body>
<script src="/js/jquery-1.9.1.min.js"></script>
<script src="/js/vue.min.js" type="text/javascript"></script>
<script src="/js/element-ui.min.js" type="text/javascript"></script>
<script src="/js/my-select.js" type="text/javascript"></script>

<script>

    function getBrowserInfo(){
        var agent = navigator.userAgent.toLowerCase() ;
        console.log(agent);
        var arr = [];
        var system = agent.split(' ')[1].split(' ')[0].split('(')[1];
        arr.push(system);
        var regStr_edge = /edge\/[\d.]+/gi;
        var regStr_ie = /trident\/[\d.]+/gi ;
        var regStr_ff = /firefox\/[\d.]+/gi;
        var regStr_chrome = /chrome\/[\d.]+/gi ;
        var regStr_saf = /safari\/[\d.]+/gi ;
        var regStr_opera = /opr\/[\d.]+/gi;
        //IE
        if(agent.indexOf("trident") > 0){
            arr.push(agent.match(regStr_ie)[0].split('/')[0]);
            arr.push(agent.match(regStr_ie)[0].split('/')[1]);
            return arr;
        }
        //Edge
        if(agent.indexOf('edge') > 0){
            arr.push(agent.match(regStr_edge)[0].split('/')[0]);
            arr.push(agent.match(regStr_edge)[0].split('/')[1]);
            return arr;
        }
        //firefox
        if(agent.indexOf("firefox") > 0){
            arr.push(agent.match(regStr_ff)[0].split('/')[0]);
            arr.push(agent.match(regStr_ff)[0].split('/')[1]);
            return arr;
        }
        //Opera
        if(agent.indexOf("opr")>0){
            arr.push(agent.match(regStr_opera)[0].split('/')[0]);
            arr.push(agent.match(regStr_opera)[0].split('/')[1]);
            return arr;
        }
        //Safari
        if(agent.indexOf("safari") > 0 && agent.indexOf("chrome") < 0){
            arr.push(agent.match(regStr_saf)[0].split('/')[0]);
            arr.push(agent.match(regStr_saf)[0].split('/')[1]);
            return arr;
        }
        //Chrome
        if(agent.indexOf("chrome") > 0){
            arr.push(agent.match(regStr_chrome)[0].split('/')[0]);
            arr.push(agent.match(regStr_chrome)[0].split('/')[1]);
            return arr;
        }else{
            arr.push('请更换主流浏览器，例如chrome,firefox,opera,safari,IE,Edge!')
            return arr;
        }
    }



    function getLocation(cb) {
        var data = {key: "4MIBZ-LJMCF-6RKJA-NGKN4-JJZFF-2JBMJ"};//ip缺省时会自动获取请求端的公网IP,
        var url = "https://apis.map.qq.com/ws/location/v1/ip";
        data.output = "jsonp";
        $.ajax({
            type: "get",
            dataType: 'jsonp',
            data: data,
            jsonp: "callback",
            url: url,
            success: function (json) {
                array = new Array;
                array.push(json.result.ip);//公网IP
                array.push(json.result.ad_info.province + json.result.ad_info.city + json.result.ad_info.district);//省市区
                array.push(json.result.location.lat);//经度
                array.push(json.result.location.lng);//纬度
                cb(array)//回调函数
            },
            error: function (err) {

            }
        });
    }




    function cb(result){
        app.toDetail(store.keyword,result)
    }


    var store = {visible: false, width: 0, message: 'AISearch', keyword: "", isShow: false, article: []};
    var app = new Vue({
        el: '#app',
        data: store,
        created: function () {

            $("#app").show();
            this.width = $("#el-input").width();

        },
        methods: {
            toDetails:function (dd) {
                getLocation(cb);
            },
            toggle: function () {
                this.isShow = !this.isShow;
            },
            blur: function () {
                this.isShow = false;
            },
            toDetail: function (keyword,location) {
                if (keyword != "") {
                    window.location.href = "todetail?keyword=" + keyword + "&location=" + location
                    +"&browserInfo=" + getBrowserInfo()

                }

            },
            upScreen: function (label) {
                store.keyword = label;
            },
            searchItem: function (keyword) {
                this.isShow = true;
                $.ajax({
                    url: "/searchItem", data: {keyword: keyword}, success: function (data) {
                        store.article = [];
                        for (var i = 0; i < data.length; i++) {
                            store.article.push(data[i]);
                        }
                    }
                });
            }
            ,
        }

    })

</script>
</html>